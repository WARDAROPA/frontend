<app-navbar></app-navbar>

<div class="home-container">
  <div class="connection-status" [class.connected]="isConnected" [class.disconnected]="!isConnected">
    {{ isConnected ? 'Conectado al servidor ‚úì' : 'Desconectado ‚úó' }}
  </div>

  <button class="fab-button" (click)="toggleCreatePost()" *ngIf="!showCreatePost">
    ‚ûï Nueva Publicaci√≥n
  </button>

  <div class="create-post-modal" *ngIf="showCreatePost">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Crear nueva publicaci√≥n</h3>
        <button class="close-btn" (click)="toggleCreatePost()">‚úï</button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="photo">Foto *</label>
          <input 
            type="file" 
            id="photo" 
            accept="image/*" 
            (change)="onFileSelected($event)"
            class="file-input"
          />
          <div class="file-name" *ngIf="selectedFileName">{{ selectedFileName }}</div>
          <div class="preview" *ngIf="newPostPhoto">
            <img [src]="newPostPhoto" alt="Preview" />
          </div>
        </div>

        <div class="form-group">
          <label for="description">Descripci√≥n</label>
          <textarea 
            id="description" 
            [(ngModel)]="newPostDescription"
            placeholder="Describe tu outfit..."
            rows="3"
          ></textarea>
        </div>

        <div class="modal-actions">
          <button class="btn-cancel" (click)="toggleCreatePost()">Cancelar</button>
          <button class="btn-publish" (click)="createPost()">Publicar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="comments-modal" *ngIf="showCommentsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Comentarios</h3>
        <button class="close-btn" (click)="closeComments()">‚úï</button>
      </div>
      
      <div class="modal-body">
        <div class="comments-list">
          <div class="comment" *ngFor="let comment of comments">
            <div class="comment-header">
              <div class="user-avatar small">{{ comment.username[0].toUpperCase() }}</div>
              <strong>{{ comment.username }}</strong>
            </div>
            <p class="comment-text">{{ comment.texto }}</p>
          </div>
          
          <div class="no-comments" *ngIf="comments.length === 0">
            <p>No hay comentarios todav√≠a</p>
            <p class="subtitle">¬°S√© el primero en comentar!</p>
          </div>
        </div>
        
        <div class="add-comment">
          <textarea 
            [(ngModel)]="newComment"
            placeholder="Escribe un comentario..."
            rows="2"
          ></textarea>
          <button class="btn-publish" (click)="addComment()">Comentar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="feed">
    <h2>Feed de Moda</h2>
    
    <div class="posts-grid">
      <div class="post-card" *ngFor="let post of posts">
        <div class="post-header">
          <div class="post-user">
            <div class="user-avatar">{{ post.username[0].toUpperCase() }}</div>
            <span class="username">{{ post.username }}</span>
          </div>
        </div>
        
        <div class="post-image">
          <img [src]="post.foto" [alt]="post.descripcion" />
        </div>
        
        <div class="post-actions">
          <button 
            class="action-btn like" 
            [class.liked]="post.user_liked"
            (click)="toggleLike(post)"
          >
            {{ post.user_liked ? '‚ù§Ô∏è' : 'ü§ç' }} {{ post.likes_count }}
          </button>
          <button class="action-btn comment" (click)="openComments(post)">üí¨ {{ post.comments_count }}</button>
          <button class="action-btn share">üì§</button>
        </div>
        
        <div class="post-description">
          <strong>{{ post.username }}</strong> {{ post.descripcion }}
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="posts.length === 0">
      <p>No hay publicaciones todav√≠a</p>
      <p class="subtitle">¬°S√© el primero en compartir tu outfit!</p>
    </div>
  </div>
</div>
